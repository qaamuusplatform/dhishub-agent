{% extends 'base.html' %}
{% block content %}

        <div class="card">
            <div class="card-body">
                <div class="row mb-0 align-items-center">
                    <div class="col">
                        <h4>All Packages</h4>
                    </div>
                    <!-- <div class="col-auto"> </div> -->
                </div>
                <hr>
                <table class="table">
                    <thead style="background-color: black;color: white;">
                        <tr>
                            <th scope="col">#</th>
                            <th scope="col">Package Name</th>
                            <th scope="col">Request-Count</th>
                            <th scope="col">Action</th>
                        </tr>
                    </thead>
                    <tbody id="user_agents_body">
                        <tr>
                            <th scope="row">1</th>
                            <td>Mark</td>
                            <td>Otto</td>
                            <td>
                                <i class="ti ti-bell"></i>
                            </td>
                        </tr>
                        <tr>
                            <th scope="row">2</th>
                            <td>Jacob</td>
                            <td>Thornton</td>
                            <td>@fat</td>
                        </tr>
                        <tr>
                            <th scope="row">3</th>
                            <td>Larry</td>
                            <td>the Bird</td>
                            <td>@twitter</td>
                        </tr>
                    </tbody>
                </table>
                <div class="text-center">
                    <a href="#!" class="b-b-primary text-primary">View all <i class="ti ti-chevron-right"></i></a>
                </div>
            </div>
        </div>

<script>
    var user_agents_body = document.getElementById("user_agents_body")
    fetch('/api/agent-user/', { method: 'GET', })
        .then(function (response) {

            return response.json();
        }).then(function (data) {
            console.log('dsadas')
            console.log(data)
            for (var request_package of data){
                console.log(request_package)
            }
        })
    document.getElementById('mainForm').addEventListener('submit', function (formEvent) {
        formEvent.preventDefault();
        submitingDiv.innerHTML = `<button class="btn btn-primary" type = "button" disabled >
            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                     registring...
            </button >
        
        `
        var formData = new FormData(formEvent.target);

        var jsonData = {
            "id": 0,
            "name": "",
            "price_per_month": 0.0,
            "requests_count": 0
        };
        formData.forEach(function (value, key) {
            jsonData[key] = value;
        });
        fetch('/api/requests-package/', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(jsonData),
            redirect: 'follow'
        }).then(function (response) {
            if (response.status) {
                // success alert
            }
            // Handle success response
            console.log(response);
        }).catch(function (error) {
            // Handle error response
            console.error(error);
        }).finally(function (response) {
            submitingDiv.innerHTML = `
                        <button type="submit" class="btn btn-primary">Submit</button>
        `

        })


    })
</script>
{% endblock %}